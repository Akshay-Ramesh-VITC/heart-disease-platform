<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heart Disease Frontend</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Heart Disease Risk</title>
    <!-- Tailwind (Play CDN for demo only) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM (UMD) and Babel for in-browser JSX transpile -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="root" class="p-4 max-w-6xl mx-auto"></div>

    <script type="text/babel">
      const { useState } = React;

      /* Simple inline icon components (small SVGs) */
      const Icon = ({children, className='w-5 h-5'}) => (
        <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" aria-hidden>
          {children}
        </svg>
      );
      const Heart = (props) => (
        <Icon {...props}><path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 1 0-7.8 7.8L12 21l8.8-8.6a5.5 5.5 0 0 0 0-7.8z"/></Icon>
      );
      const BarChart3 = (props) => (
        <Icon {...props}><rect x="3" y="11" width="4" height="10"/><rect x="9" y="7" width="4" height="14"/><rect x="15" y="3" width="4" height="18"/></Icon>
      );
      const AlertCircle = (props) => (
        <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M12 8v4"/><path d="M12 16h.01"/></Icon>
      );
      const CheckCircle = (props) => (
        <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5-8.66"/><path d="M22 4L12 14.01 9 11.01"/></Icon>
      );
      const User = (props) => (
        <Icon {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>
      );
      const Activity = (props) => (
        <Icon {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></Icon>
      );

      function HeartDiseaseAssessment(){
        const [activeTab, setActiveTab] = useState('demographics');
        const [loading, setLoading] = useState(false);
        const [prediction, setPrediction] = useState(null);
        const [error, setError] = useState(null);
        const [formData, setFormData] = useState({
          age: 55, sex: 'male', bmi: 27,
          systolic_bp: 130, diastolic_bp: 80, heart_rate: 75, prevalent_hypertension: 0,
          total_cholesterol:200, hdl:50, ldl:120, triglycerides:150, fasting_glucose:95, diabetes:0,
          sodium:140, potassium:4.2, calcium:9.5, creatinine:1.0, egfr:90,
          smoking:0, physical_activity: 'moderate', family_history:0
        });

        const handleInputChange = (e) => {
          const { name, value, type, checked } = e.target;
          setFormData(prev => ({...prev, [name]: type === 'checkbox' ? (checked ? 1 : 0) : (type==='number'? Number(value): value)}));
        };

        const handleSubmit = async () => {
          setLoading(true); setError(null); setPrediction(null);
          try{
            const res = await fetch('/api/predict', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(formData)});
            if(!res.ok){ const err = await res.json(); throw new Error(err.detail || 'Prediction failed'); }
            const json = await res.json(); setPrediction(json);
          }catch(err){ setError(err.message); }
          finally{ setLoading(false); }
        };

        const getRiskColor = (risk) => risk < 30 ? 'text-green-600' : risk < 70 ? 'text-yellow-600' : 'text-red-600';
        const getRiskLabel = (risk) => risk < 30 ? 'Low Risk' : risk < 70 ? 'Medium Risk' : 'High Risk';

        return (
          <div className="space-y-6">
            <div className="bg-white rounded-lg shadow-lg p-6">
              <div className="flex items-center gap-3 mb-2">
                <Heart className="w-10 h-10 text-red-500" />
                <h1 className="text-2xl font-bold text-gray-800">Multi-Modal Heart Disease Risk Assessment</h1>
              </div>
              <p className="text-gray-600">AI-powered cardiovascular risk prediction</p>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <div className="lg:col-span-2">
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <div className="flex border-b mb-6 overflow-x-auto">
                    {[{id:'demographics',icon:User,label:'Demographics'},{id:'cardiovascular',icon:Activity,label:'Cardiovascular'},{id:'metabolic',icon:Activity,label:'Metabolic'},{id:'labs',icon:Activity,label:'Labs'}].map(tab=> (
                      <button key={tab.id} onClick={()=>setActiveTab(tab.id)} className={`flex items-center gap-2 px-4 py-3 font-medium whitespace-nowrap ${activeTab===tab.id? 'border-b-2 border-blue-500 text-blue-600':'text-gray-500 hover:text-gray-700'}`}>
                        <tab.icon className="w-4 h-4" />
                        {tab.label}
                      </button>
                    ))}
                  </div>

                  {activeTab==='demographics' && (
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Age</label>
                          <input name="age" type="number" value={formData.age} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Sex</label>
                          <select name="sex" value={formData.sex} onChange={handleInputChange} className="w-full px-3 py-2 border rounded">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">BMI</label>
                          <input name="bmi" type="number" step="0.1" value={formData.bmi} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Physical Activity</label>
                          <select name="physical_activity" value={formData.physical_activity} onChange={handleInputChange} className="w-full px-3 py-2 border rounded">
                            <option value="sedentary">Sedentary</option>
                            <option value="light">Light</option>
                            <option value="moderate">Moderate</option>
                            <option value="active">Active</option>
                          </select>
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        <input name="smoking" type="checkbox" checked={formData.smoking===1} onChange={handleInputChange} />
                        <label>Current Smoker</label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input name="family_history" type="checkbox" checked={formData.family_history===1} onChange={handleInputChange} />
                        <label>Family History</label>
                      </div>
                    </div>
                  )}

                  {activeTab==='cardiovascular' && (
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Systolic BP</label>
                          <input name="systolic_bp" type="number" value={formData.systolic_bp} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Diastolic BP</label>
                          <input name="diastolic_bp" type="number" value={formData.diastolic_bp} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Heart Rate</label>
                          <input name="heart_rate" type="number" value={formData.heart_rate} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        <input name="prevalent_hypertension" type="checkbox" checked={formData.prevalent_hypertension===1} onChange={handleInputChange} />
                        <label>Diagnosed Hypertension</label>
                      </div>
                    </div>
                  )}

                  {activeTab==='metabolic' && (
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Total Cholesterol</label>
                          <input name="total_cholesterol" type="number" value={formData.total_cholesterol} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">HDL</label>
                          <input name="hdl" type="number" value={formData.hdl} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">LDL</label>
                          <input name="ldl" type="number" value={formData.ldl} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Triglycerides</label>
                          <input name="triglycerides" type="number" value={formData.triglycerides} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Fasting Glucose</label>
                          <input name="fasting_glucose" type="number" value={formData.fasting_glucose} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        <input name="diabetes" type="checkbox" checked={formData.diabetes===1} onChange={handleInputChange} />
                        <label>Diagnosed Diabetes</label>
                      </div>
                    </div>
                  )}

                  {activeTab==='labs' && (
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Sodium</label>
                          <input name="sodium" type="number" step="0.1" value={formData.sodium} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Potassium</label>
                          <input name="potassium" type="number" step="0.1" value={formData.potassium} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Calcium</label>
                          <input name="calcium" type="number" step="0.1" value={formData.calcium} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Creatinine</label>
                          <input name="creatinine" type="number" step="0.1" value={formData.creatinine} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">eGFR</label>
                          <input name="egfr" type="number" value={formData.egfr} onChange={handleInputChange} className="w-full px-3 py-2 border rounded" />
                        </div>
                      </div>
                    </div>
                  )}

                  <div className="mt-6 pt-6 border-t">
                    <button onClick={handleSubmit} disabled={loading} className="w-full bg-blue-600 text-white py-3 rounded-md flex items-center justify-center gap-2">
                      {loading ? <div className="animate-spin h-5 w-5 border-b-2 border-white rounded-full"/> : <BarChart3 className="w-5 h-5"/>}
                      {loading ? 'Analyzing...' : 'Assess Risk'}
                    </button>
                  </div>
                </div>
              </div>

              <div className="lg:col-span-1">
                <div className="bg-white rounded-lg shadow-lg p-6 sticky top-4">
                  <h2 className="text-xl font-bold mb-4">Risk Assessment</h2>
                  {error && (
                    <div className="bg-red-50 border border-red-200 rounded-md p-4 mb-4">
                      <div className="flex items-start gap-2">
                        <AlertCircle className="w-5 h-5 text-red-500" />
                        <div>
                          <p className="text-sm font-medium text-red-800">Error</p>
                          <p className="text-sm text-red-600">{error}</p>
                        </div>
                      </div>
                    </div>
                  )}

                  {!prediction && !error && (
                    <div className="text-center py-12">
                      <Heart className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                      <p className="text-gray-500">Fill patient data and click "Assess Risk"</p>
                    </div>
                  )}

                  {prediction && (
                    <div className="space-y-6">
                      <div className="text-center">
                        <div className={`text-5xl font-bold ${getRiskColor(prediction.risk_probability*100)}`}>
                          {(prediction.risk_probability*100).toFixed(1)}%
                        </div>
                        <div className={`text-lg font-semibold mt-2 ${getRiskColor(prediction.risk_probability*100)}`}>{getRiskLabel(prediction.risk_probability*100)}</div>
                        <p className="text-sm text-gray-600 mt-2">{prediction.risk_category}</p>
                      </div>

                      <div>
                        <h3 className="font-semibold text-gray-700 text-sm">Modal Risk Scores</h3>
                        <div className="space-y-3 mt-2">
                          {Object.entries(prediction.modal_scores).map(([k,v])=> (
                            <div key={k}>
                              <div className="flex justify-between text-sm mb-1"><span className="capitalize text-gray-600">{k}</span><span className="font-medium">{(v*100).toFixed(1)}%</span></div>
                              <div className="w-full bg-gray-200 rounded-full h-2"><div className={`h-2 rounded-full ${v<0.3? 'bg-green-500': v<0.7? 'bg-yellow-500':'bg-red-500'}`} style={{width:`${v*100}%`}}/></div>
                            </div>
                          ))}
                        </div>
                      </div>

                      <div>
                        <h3 className="font-semibold text-gray-700 text-sm mb-3">Top Contributing Factors</h3>
                        <div className="space-y-2">
                          {prediction.feature_importance.slice(0,5).map((it,idx)=> (
                            <div key={idx} className="flex items-center gap-2"><div className="w-2 h-2 bg-blue-500 rounded-full"/><span className="text-sm text-gray-700">{it.feature || it.name}</span><span className="text-xs text-gray-500 ml-auto">{((it.importance||it.value||0)*100).toFixed(1)}%</span></div>
                          ))}
                        </div>
                      </div>

                      {prediction.recommendations && prediction.recommendations.length>0 && (
                        <div className="bg-blue-50 rounded-md p-4">
                          <h3 className="font-semibold text-blue-900 text-sm mb-2 flex items-center gap-2"><CheckCircle className="w-4 h-4"/>Recommendations</h3>
                          <ul className="space-y-1">{prediction.recommendations.map((r,i)=> <li key={i} className="text-sm text-blue-800">â€¢ {r}</li>)}</ul>
                        </div>
                      )}
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<HeartDiseaseAssessment />);
    </script>
  </body>
</html>
